app.factory('popupGitFactory', function($http) {
    var domain = "http://localhost:1337";

    return {

        getUserInfo: function() {
          return $http.get(domain + "/session").then(function(res){
            return res.data; //res.data.user
          });
        },

        getReposToAdd: function(token) {
          console.log('hit getrepo', token)
          return $http.get(domain + "/api/git", {params: token})
          .then(function(res) {
            return res.data;
          })
        },

        getContributors: function(token, contributorUrl) {
          var i = contributorUrl.match(/repos/).index + 6;
          var repo = contributorUrl.slice(i, -13);
          console.log('!!!!!',repo)
          // return $http.get(domain + "/api/git/" + repo + '/contributors', {params: token})
          // .then(function(res) {
          //   return res.data;
          // })
        },

        //adding or deleting repo from profile
        editRepo: function(user) {
          console.log('addRepoToProfile factory',user.repos)
          var repo = {repo: user.repos}
          return $http.put(domain + "/api/users/" + user.github.username + "/editRepo", repo)
          .then(function(res) {
            return res.data;
          })
        },

        archiveRepo: function(user) {
          console.log('archieve repo factory', user.archives);
          var archives = {repo: user.archives}
          return $http.put(domain + '/api/users/' + user.github.username + '/archiveRepo', archives)
          .then(function(res) {
            return res.data;
          })
        },

        listFiles: function(repo) {
          console.log('list file names under the repo', repo)
          return $http.get(domain + "/api/file/repo/" + repo.name)
          .then(function(res) {
            return res.data;
          })
        },

        getARepo: function(repoUrl) {
          console.log('is there such repo? factory', repoUrl)
          return $http.get(domain + "/api/repo/", {params: repoUrl})
          .then(function(res){
            return res.data;
          })
        },

        createARepo: function(repo) {
          return $http.post(domain + "/api/repo", repo)
          .then(function(res) {
            return res.data;
          })
        },

        logout: function() {
          console.log('hitting the factory')
          return $http.get(domain +'/logout').then(function () {
      			//this needs a logic remap
            	console.log('logged out');
      		});
        }

    }
});


//extension on
//tab bar
//
